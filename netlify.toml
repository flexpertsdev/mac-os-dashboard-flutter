[build]
  publish = "build/web"
  command = """
    # Install Flutter in home directory (we have write permissions there)
    FLUTTER_HOME="$HOME/flutter"
    if [ ! -d "$FLUTTER_HOME" ]; then
      echo "Installing Flutter to $FLUTTER_HOME..."
      cd $HOME
      curl -o flutter_linux_3.16.0-stable.tar.xz https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.16.0-stable.tar.xz
      tar xf flutter_linux_3.16.0-stable.tar.xz
      rm flutter_linux_3.16.0-stable.tar.xz
    fi
    
    # Add Flutter to PATH
    export PATH="$FLUTTER_HOME/bin:$PATH"
    
    # Verify Flutter installation
    flutter doctor --machine
    
    # Enable web support and build
    flutter config --enable-web
    flutter pub get
    flutter build web --release
  """

[build.environment]
  FLUTTER_VERSION = "3.16.0"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[context.production.environment]
  FLUTTER_WEB = "true"
  
[context.deploy-preview.environment]
  FLUTTER_WEB = "true"